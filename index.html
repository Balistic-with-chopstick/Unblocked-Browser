// Install these dependencies first: npm install express axios cors

const express = require('express');
const axios = require('axios');
const cors = require('cors');
const url = require('url');

const app = express();
const PORT = 3001; // Choose any port you wish

// Enable CORS (Cross-Origin Resource Sharing)
app.use(cors());

// Proxy route to fetch external content
app.get('/proxy', async (req, res) => {
    const targetUrl = req.query.url;

    if (!targetUrl) {
        return res.status(400).send('Missing "url" parameter.');
    }

    try {
        // Extract the target URL
        const parsedUrl = url.parse(targetUrl);

        // Optional: Add validation to restrict certain domain access
        const allowedHosts = ['example.com', 'another-allowed-host.com'];
        if (!allowedHosts.includes(parsedUrl.host)) {
            return res.status(403).send('Access to this domain is not allowed.');
        }

        // Fetch data from the target URL
        const response = await axios.get(targetUrl);

        // Return the content of the target site through the proxy
        res.send(response.data);
    } catch (error) {
        console.error('Error fetching remote content:', error.message);
        res.status(500).send('Failed to fetch content.');
    }
});

// Start the server
app.listen(PORT, () => {
    console.log(`Proxy server running on http://localhost:${PORT}`);
});
